      MODULE GRMODEL

      CONTAINS 
      FUNCTION CAL_PARTI(T0)
      IMPLICIT NONE
      REAL(KIND=8)::CAL_PARTI
      REAL(KIND=8),EXTERNAL::SPLINT
*>c at temperatures above 2900 K, the vapor pressure of silicon is less
*>c than that of sic2. The following uses vapor pressure of sic2 at
*>c temperature below 2900 K and that of silicon above 2900 K.????
      INTEGER(KIND=4)::N=19
      REAL(KIND=8)::P_A(N),T_A(N),T0
      DATA P_A/5.131E-8,1.372E-6,2.473E-5,3.207E-4,
     1         3.153E-3,2.452E-2,1.559E-1,8.352E-1,
     1         3.839,15.47,55.56,96.492,170.02,456.3,1137.9,2366, 
     1         4419,7922,10477/
      DATA T_A/1500,1600,1700,1800,1900,2000,2100,2200,
     1         2300,2400,2500,2546,2600,2700,2800,2900,
     1         3000,3100,3150/
      IF(TO.LT.1500)THEN
      CAL_PARTI=5.131E-8
      ELSEIF(T0.GE.1500.AND.T0.LE.3150)THEN
      CAL_PARTI=SPLINT(T_A,P_A,N,T0)
      ELSE
*>      CAL_PARTI=10477
      CAL_PARTI=17418
      ENDIF
      RETURN
      END FUNCTION CAL_PARTI

      FUNCTION CAL_PARTI_S(T0)
*>USED IN THE POWDER TO COMPUTE SATURATE PRESSURE OF SPECIES SIC2
      IMPLICIT NONE
      REAL(KIND=8)::CAL_PARTI_S
      REAL(KIND=8),EXTERNAL::SPLINT
      INTEGER(KIND=4)::N=19
      REAL(KIND=8)::PSIC2(N),PSI(N),P_A(N),T_A(N),Y2(N),T0
*>c vapor pressure of sic2 for reaction 2sic=sic2+si
      DATA PSIC2/5.131d-8,1.372d-6,2.473d-5,3.207d-4,
     1           3.153d-3,2.452d-2,1.559d-1,8.352d-1,
     1           3.839,15.47,55.56,96.492,170.02,456.3,1137.9,2659,
     1           5855,12250,17418/
*>c satuated vapor pressure of silicon
      DATA PSI/2.339d-4,2.38d-3,1.8d-2,9.73d-2,3.847d-1,1.408,
     1         4.549,13.17,34.72,84.28,190.29,270.64,402.87,805.94,
     1         1533.04,2786,4861,8177,10477/
*>c in K
      DATA T_A/1500,1600,1700,1800,1900,2000,2100,2200,
     1         2300,2400,2500,2546,2600,2700,2800,2900,
     1         3000,3100,3150/
*>c at temperatures above 2900 K, the vapor pressure of silicon is less
*>c then that of sic2. The following uses vapor pressure of sic2 at
*>c temperature below 2900 K and that of silicon above 2900 K.
      DATA P_A/5.131d-8,1.372d-6,2.473d-5,3.207d-4,
     1         3.153d-3,2.452d-2,1.559d-1,8.352d-1,
     1         3.839,15.47,55.56,96.492,170.02,456.3,1137.9,2366,
     1         4419,7922,10477/
      CAL_PARTI_S=SPLINT(T_A,P_A,N,T0)
      RETURN
      END FUNCTION CAL_PARTI_S

      FUNCTION CAL_PARTI_SIC(T0)
      IMPLICIT NONE
      REAL(KIND=8),EXTERNAL::SPLINT
      REAL(KIND=8)::CAL_PARTI_SIC
      INTEGER(KIND=4)::N=19
      REAL(KIND=8)::PSIC(N),T_A(N),T0
      DATA T_A/1500,1600,1700,1800,1900,2000,2100,2200,
     1         2300,2400,2500,2546,2600,2700,2800,2900,
     1         3000,3100,3150/
      DATA PSIC/6.2d-13,3.2d-11,1.0d-9,2.3d-8,3.7d-7,4.4d-6,
     1          4.2d-5,3.2d-4,2.0d-3,1.11d-2,5.23d-2,1.02d-1,0.2188,
     1          0.8195,2.784,8.673,24.98,67.19,107.61/
      CAL_PARTI_SIC=SPLINT(T_A,PSIC,N,T0)
      RETURN
      END FUNCTION CAL_PARTI_SIC

      FUNCTION CAL_PARTI_SIC2(T0)
      IMPLICIT NONE
      REAL(KIND=8),EXTERNAL::SPLINT
      REAL(KIND=8)::CAL_PARTI_SIC2
      INTEGER(KIND=4)::N=19
      REAL(KIND=8)::PSIC2(N),T_A(N),T0
      DATA PSIC2/5.131d-8,1.372d-6,2.473d-5,3.207d-4,
     1           3.153d-3,2.452d-2,1.559d-1,8.352d-1,
     1           3.839,15.47,55.56,96.492,170.02,456.3,1137.9,2659,
     1           5855,12250,17418/
      DATA T_A/1500,1600,1700,1800,1900,2000,2100,2200,
     1         2300,2400,2500,2546,2600,2700,2800,2900,
     1         3000,3100,3150/
      CAL_PARTI_SIC2=SPLINT(T_A,PSIC2,N,T0)
      RETURN
      END FUNCTION SIC2

      FUNCTION CAL_PARTI_SI(T0)
      IMPLICIT NONE
      REAL(KIND=8),EXTERNAL::SPLINT
      REAL(KIND=8)::CAL_PARTI_SI
      INTEGER(KIND=4)::N=19
      REAL(KIND=8)::PSI(N),T_A(N),T0
*> for t ge 2900 si vapor pressures are taken as satuated silicon pressure
*> times activity of silicon.
      DATA PSI/3.00d-6,4.23d-5,4.35d-4,3.451d-3,2.191d-2,1.152d-1,
     1         0.5163,2.012,6.96,21.67,61.44,96.522,170.02,456.3,
     1         1137.9,2366,4419,7922,10477/
      DATA T_A/1500,1600,1700,1800,1900,2000,2100,2200,
     1         2300,2400,2500,2546,2600,2700,2800,2900,
     1         3000,3100,3150/
      CAL_PARTI_SI=SPLINT(T_A,PSI,N,T0)
      RETURN
      END FUNCTION CAL_PARTI_SI

      FUNCTION CAL_PARTI_SI2C(T0)
      IMPLICIT NONE
      REAL(KIND=8),EXTERNAL::SPLINT
      REAL(KIND=8)::CAL_PARTI_SI2C
      INTEGER(KIND=4)::N
      REAL(KIND=8)::PSI2C(N),T_A(N),T0
      DATA PSI2C/2.52d-8,6.85d-7,1.24d-5,1.63d-4,1.61d-3,
     1           1.256d-2,8.006d-2,4.281d-1,1.966,7.913,28.32,49.12,
     1           91.48,269.8,733.6,1853,4384,9811,14398/
      DATA T_A/1500,1600,1700,1800,1900,2000,2100,2200,
     1         2300,2400,2500,2546,2600,2700,2800,2900,
     1         3000,3100,3150/
      CAL_PARTI_SI2C=SPLINT(T_A,PSI2C,N,T0)
      RETURN
      END FUNCTION CAL_PARTI_SI2C

      FUNCTION SPEED_FUN(T,DEL_T,PRES_SYS,DIST,GROWTHSP,PA_SEED)
*>SEED SURFACE
*>PA(L)=PA_SAT(L)+U*PRES_SYS/2/XAPA/RB/T
*>U=D_AB/L*IN((PRES_SYS-2*PA(L))/(PRES_SYS-2*PA(0)))
*>D_AB=D0*(T/273)**n*(1.0E+5/PRES_SYS)
*>INTERATION METHOD USED TO COMPUTE TWO UNKONWNS EQUS
*>***************************************************************
*>USED BY SUBROUTINE CAL_GR_STER AND CAL_GR_STER_PRES FOR GROWTH RATE
*>OF DIFFERENT TEMPERATURE GRADIENT(DEL_T) OR PRESSURE.
      IMPLICIT NONE
      REAL(KIND=8),EXTERNAL::CAL_PARTI_S,CAL_PARTI_SIC,
     1     CAL_PARTI_SI,CAL_PARTI_SIC2,CAL_PARTI_SI2C
      REAL(KIND=8)::SPEED_FUN
      REAL(KIND=8)::T,DEL_T,PRES_SYS,DIST,GROWTHSP,PA_SEED
      REAL(KIND=8)::TA0,PA0,PRES_SYS_M,TOTAL_VAPOR
      REAL(KIND=8)::PI=3.1415926,MSIC=0.04,RB=8.31,RHO0=3160,D0=1.0E-5
      REAL(KIND=8)::UREF,UREF1,XAPA,PA1,CRED
      TA0=T+DEL_T
      PA0=CAL_PARTI_S(TA0)
      PRES_SYS_M=PRES_SYS
      TOTAL_VAPOR=CAL_PARTI_SIC(TA0)+CAL_PARTI_SI(TA0)+
     1            CAL_PARTI_SIC2(TA0)+CAL_PARTI_SI2C(TA0)
      IF(TOTAL_VAPOR.GT.PRES_SYS)THEN
      PRES_SYS_M=TOTAL_VAPOR
      ENDIF
*>ASSUMING THE ADVECTIVE VELOCITIES OF SIC2 AND SI TO BE THE SAME
*>PRESSURE OBTAINED BY A 1D MASS TRANSFER EQU FOR STEFAN FLOW
*>REF:"MODELING OF TRANSPORT PROCESSES AND KINETICS OF SIC GROWTH" 
*>JCG 2001
      UREF=0
      DO WHILE(.TRUE.)
      UREF1=UREF
      XAPA=1/SQRT(2*PI*MSIC*RB*T)
      PA1=CAL_PARTI_S(T)+UREF*PRES_SYS_M/2/XAPA/RB/T
      CRED=(PRES_SYS_M-2*PA1)/(PRES_SYS_M-2*PA0)
      D_AB=D0*(T/273)**1.8*(1.0E+5/PRES_SYS_M)
      UREF=LOG(CRED)*D_AB/DIST
      UREF=UREF+(UREF-UREF1)*0.1
      WRITE(*,*)'UREF',UREF,'PA0',PA0,'PA1',PA1
      IF(ABS(UREF-UREF1).LT.1.0E-6)EXIT
      ENDDO
*>GROWTHSP:M/S,MSIC OF SIC:0.040097KG/MOL,RHO0:3160KG/M3,CCEN:MOL/M3
      GROWTHSP=UREF
      PA_SEED=PA1
      WRITE(*,*)PA0,'PASCAL',GROWTHSP,'M/S',CCEN,'MOL/M3',T
      GHK=UREF*PRES_SYS_M/RB/T*MSIC/RHO0*3600*1000
      RETURN
      END FUNCTION SPEED_FUN
      END MODULE GRMODEL
